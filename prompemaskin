<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompemaskin</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#121a27cc;
      --stroke:#243044;
      --text:#e7eefc;
      --muted:#9bb0d1;
      --accent:#7c5cff;
      --good:#27d3a2;
      --bad:#ff5c7a;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 10%, rgba(124,92,255,.22), transparent 55%),
                  radial-gradient(900px 600px at 80% 30%, rgba(39,211,162,.16), transparent 60%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{
      width:min(880px, 100%);
      display:grid;
      gap:16px;
      grid-template-columns: 1.05fr .95fr;
    }
    @media (max-width: 860px){
      .wrap{grid-template-columns:1fr}
    }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:18px;
      backdrop-filter: blur(10px);
    }
    h1{
      margin:0 0 8px 0;
      font-size:22px;
      letter-spacing:.2px;
    }
    p{margin:0 0 14px 0; color:var(--muted); line-height:1.45}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      appearance:none;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(124,92,255,.25), rgba(124,92,255,.10));
      color:var(--text);
      border-radius:14px;
      padding:12px 14px;
      font-weight:650;
      cursor:pointer;
      transition: transform .08s ease, filter .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{filter: brightness(1.08); border-color: rgba(124,92,255,.55)}
    .btn:active{transform: translateY(1px)}
    .btn.stop{
      background: linear-gradient(180deg, rgba(255,92,122,.20), rgba(255,92,122,.08));
      border-color: rgba(255,92,122,.35);
    }
    .btn.stop:hover{border-color: rgba(255,92,122,.65)}
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      font-size:12px;
    }
    .badge.on{ color: rgba(39,211,162,.95); border-color: rgba(39,211,162,.35); background: rgba(39,211,162,.08);}
    .badge.off{ color: rgba(255,92,122,.95); border-color: rgba(255,92,122,.35); background: rgba(255,92,122,.08);}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 540px){
      .grid{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    input[type="range"], input[type="number"]{
      width:100%;
    }
    input[type="number"]{
      background: rgba(15,22,35,.55);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:10px 12px;
      color: var(--text);
      outline:none;
    }
    input[type="number"]:focus{
      border-color: rgba(124,92,255,.65);
    }
    .log{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      color:#cfe0ff;
      background: rgba(10,14,22,.55);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:12px;
      min-height:110px;
      max-height:220px;
      overflow:auto;
      white-space:pre-wrap;
    }
    .small{font-size:12px; color:var(--muted); margin-top:10px}
    .hint{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px;
      border:1px dashed rgba(155,176,209,.35);
      border-radius:14px;
      color:var(--muted);
      background: rgba(155,176,209,.06);
    }
    .dot{
      width:10px; height:10px; border-radius:999px; margin-top:4px;
      background: radial-gradient(circle at 35% 35%, #fff, rgba(255,255,255,.2) 40%, rgba(255,255,255,0) 70%),
                  var(--accent);
      box-shadow: 0 0 18px rgba(124,92,255,.35);
      flex:0 0 auto;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üí® Prompemaskin</h1>
      <p>Trykk start, s√• spiller den prompelyder helt tilfeldig. Perfekt for √• ‚Äúplassere‚Äù telefonen et lurt sted.</p>

      <div class="row" style="margin-bottom:12px;">
        <button id="startBtn" class="btn">Start prompemaskin</button>
        <button id="stopBtn" class="btn stop" disabled>Stopp</button>
        <span id="status" class="badge off">AV</span>
      </div>

      <div class="grid">
        <div>
          <label for="minSec">Min sekunder mellom promp (f.eks. 2)</label>
          <input id="minSec" type="number" min="0.5" step="0.5" value="2" />
        </div>
        <div>
          <label for="maxSec">Max sekunder mellom promp (f.eks. 12)</label>
          <input id="maxSec" type="number" min="1" step="0.5" value="12" />
        </div>
        <div>
          <label for="chance">Sjanse per ‚Äútick‚Äù (i %). Lavere = mer uforutsigbart</label>
          <input id="chance" type="number" min="5" max="100" step="1" value="55" />
        </div>
        <div>
          <label for="volume">Volum</label>
          <input id="volume" type="range" min="0" max="1" step="0.01" value="0.75" />
        </div>
      </div>

      <div class="hint" style="margin-top:14px;">
        <div class="dot"></div>
        <div>
          Tips: Sett <b>Min=6</b>, <b>Max=25</b>, og <b>Sjanse=35%</b> for ‚Äúsjeldne, men overbevisende‚Äù promp.
        </div>
      </div>

      <div class="small">
        NB: Nettlesere tillater vanligvis ikke auto-lyd uten at du har trykket p√• en knapp f√∏rst ‚Äì derfor fungerer Start-knappen som ‚Äúunlock‚Äù.
      </div>
    </div>

    <div class="card">
      <h1>üßæ Logg</h1>
      <p>Her ser du hva appen gj√∏r (nyttig n√•r du tester).</p>
      <div id="log" class="log"></div>
    </div>
  </div>

<script>
(() => {
  // Lydkilder (jsDelivr CDN)
  // - 3 forskjellige mp3 fra SlimThickens/Fart-sounds repo: fart-8, fart-9, proud-fart
  // - 1 mp3 fra npm pakken fartify: fart.mp3
  const SOUND_URLS = [
    "https://cdn.jsdelivr.net/gh/SlimThickens/Fart-sounds@main/fart-8-228244.mp3",
    "https://cdn.jsdelivr.net/gh/SlimThickens/Fart-sounds@main/fart-9-228245.mp3",
    "https://cdn.jsdelivr.net/gh/SlimThickens/Fart-sounds@main/proud-fart-288263.mp3",
    "https://cdn.jsdelivr.net/npm/fartify@1.0.1/fart.mp3"
  ];

  const el = (id) => document.getElementById(id);
  const startBtn = el("startBtn");
  const stopBtn  = el("stopBtn");
  const statusEl = el("status");
  const logEl    = el("log");

  const minSecEl = el("minSec");
  const maxSecEl = el("maxSec");
  const chanceEl = el("chance");
  const volumeEl = el("volume");

  let running = false;
  let timerId = null;

  // Preload audio objects
  const audios = SOUND_URLS.map((url) => {
    const a = new Audio(url);
    a.preload = "auto";
    a.crossOrigin = "anonymous";
    return a;
  });

  function log(line) {
    const ts = new Date().toLocaleTimeString();
    logEl.textContent = `[${ts}] ${line}\n` + logEl.textContent;
  }

  function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

  function readSettings() {
    let minSec = parseFloat(minSecEl.value);
    let maxSec = parseFloat(maxSecEl.value);
    let chance = parseInt(chanceEl.value, 10);

    if (!Number.isFinite(minSec)) minSec = 2;
    if (!Number.isFinite(maxSec)) maxSec = 12;
    if (!Number.isFinite(chance)) chance = 55;

    // Ensure min <= max
    if (minSec > maxSec) [minSec, maxSec] = [maxSec, minSec];

    minSec = clamp(minSec, 0.5, 120);
    maxSec = clamp(maxSec, 1, 300);
    chance = clamp(chance, 5, 100);

    return { minSec, maxSec, chance };
  }

  function setUI(isOn) {
    running = isOn;
    startBtn.disabled = isOn;
    stopBtn.disabled = !isOn;

    statusEl.textContent = isOn ? "P√Ö" : "AV";
    statusEl.classList.toggle("on", isOn);
    statusEl.classList.toggle("off", !isOn);
  }

  function pickRandomAudio() {
    return audios[Math.floor(Math.random() * audios.length)];
  }

  function randomBetween(min, max) {
    return min + Math.random() * (max - min);
  }

  async function playFart() {
    const a = pickRandomAudio();

    // Sett volum p√• alle, i tilfelle tidligere avspilling har endret noe
    const v = parseFloat(volumeEl.value);
    audios.forEach(x => x.volume = v);

    try {
      // Restart lyd hvis den allerede spiller
      a.pause();
      a.currentTime = 0;

      await a.play();
      log("üí® Promp!");
    } catch (err) {
      log("‚ö†Ô∏è Klarte ikke √• spille lyd (nettleser-blokkering eller nettverk). Pr√∏v Start igjen.");
      console.warn(err);
    }
  }

  function scheduleNext() {
    if (!running) return;

    const { minSec, maxSec, chance } = readSettings();
    const waitSec = randomBetween(minSec, maxSec);

    timerId = window.setTimeout(async () => {
      if (!running) return;

      const roll = Math.random() * 100;
      if (roll <= chance) {
        await playFart();
      } else {
        log(`‚Ä¶ Ingen promp (rullet ${roll.toFixed(1)} > ${chance}%)`);
      }

      scheduleNext();
    }, Math.round(waitSec * 1000));

    log(`Neste ‚Äúmulighet‚Äù om ca. ${waitSec.toFixed(1)}s`);
  }

  function stop() {
    if (timerId) window.clearTimeout(timerId);
    timerId = null;

    // Stopp eventuell avspilling
    audios.forEach(a => { try { a.pause(); } catch {} });

    setUI(false);
    log("Stoppet.");
  }

  startBtn.addEventListener("click", async () => {
    // ‚ÄúUnlock‚Äù audio: spill en ultrakort, stille start (best effort)
    // Noen browsere krever at f√∏rste play() skjer direkte i click-handler.
    audios.forEach(a => a.volume = parseFloat(volumeEl.value));

    setUI(true);
    log("Startet.");

    // Best-effort: varm opp ved √• pr√∏ve √• spille/pause 1 lyd raskt (kan feile, men ok)
    try {
      const warm = pickRandomAudio();
      warm.volume = 0.0001;
      await warm.play();
      warm.pause();
      warm.currentTime = 0;
      warm.volume = parseFloat(volumeEl.value);
      log("Audio klar ‚úÖ");
    } catch {
      log("Audio varm-up feilet (ofte ok). Fortsetter likevel.");
    }

    scheduleNext();
  });

  stopBtn.addEventListener("click", stop);

  // Starttilstand
  setUI(false);
  log("Klar. Trykk Start.");
})();
</script>
</body>
</html>
